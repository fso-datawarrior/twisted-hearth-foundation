
#  Twisted Hearth Foundation - Admin Area Implementation Plan

## üìã **Project Overview**

This document outlines the complete implementation plan for the Admin Area of the Twisted Hearth Foundation event management platform. The admin system provides Jamie & Kat with comprehensive control over RSVPs, tournaments, gallery moderation, and all site features while maintaining the magical experience for guests.

---

## üéØ **Current State Analysis**

### ‚úÖ **Already Implemented**
- Basic auth system with `RequireAuth` component
- RSVP system with database integration
- Database schema with users and RSVPs tables
- Magic link authentication
- Auto sign-out after party ends

### ‚ùå **Missing Infrastructure**
- Admin role system and `RequireAdmin` component
- Admin area pages and routing
- Tournament database tables
- Admin-specific management tools
- Gallery and comment moderation system

---

## üöÄ **Implementation Phases**

### **Phase 1: Database & Admin Role System**

#### **1.1 Admin Role Infrastructure**

```sql
-- Create admin role table and helper function
CREATE TABLE IF NOT EXISTS public.user_roles (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  role TEXT NOT NULL CHECK (role IN ('admin')),
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Helper function to check admin status
CREATE OR REPLACE FUNCTION public.is_admin()
RETURNS BOOLEAN
LANGUAGE SQL
STABLE
SECURITY DEFINER
SET search_path = public
AS $$
  SELECT EXISTS(
    SELECT 1
    FROM public.user_roles ur
    WHERE ur.user_id = auth.uid() AND ur.role = 'admin'
  );
$$;

-- Grant execute permission
GRANT EXECUTE ON FUNCTION public.is_admin() TO authenticated;

-- Seed admin user (replace with actual user ID)
INSERT INTO public.user_roles (user_id, role) 
VALUES ('<YOUR-USER-UUID>', 'admin')
ON CONFLICT (user_id) DO UPDATE SET role = excluded.role;
```

#### **1.2 Tournament Tables**

```sql
-- Tournament registrations
CREATE TABLE IF NOT EXISTS public.tournament_registrations (
  registration_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES public.users(user_id) ON DELETE CASCADE,
  team_name TEXT NOT NULL,
  partner_email TEXT,
  skill_level TEXT CHECK (skill_level IN ('beginner', 'intermediate', 'advanced')),
  tagline TEXT,
  is_free_agent BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Tournament teams
CREATE TABLE IF NOT EXISTS public.tournament_teams (
  team_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team_name TEXT NOT NULL,
  player1_id UUID REFERENCES public.users(user_id),
  player2_id UUID REFERENCES public.users(user_id),
  seed_position INTEGER,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Tournament matches
CREATE TABLE IF NOT EXISTS public.tournament_matches (
  match_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  team1_id UUID REFERENCES public.tournament_teams(team_id),
  team2_id UUID REFERENCES public.tournament_teams(team_id),
  round_number INTEGER NOT NULL,
  match_number INTEGER NOT NULL,
  winner_id UUID REFERENCES public.tournament_teams(team_id),
  score1 INTEGER DEFAULT 0,
  score2 INTEGER DEFAULT 0,
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'completed')),
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
```

#### **1.3 Gallery and Comments Tables**

```sql
-- Photos table for metadata & moderation
CREATE TABLE IF NOT EXISTS public.photos (
  photo_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES public.users(user_id) ON DELETE CASCADE,
  storage_path TEXT NOT NULL,
  caption TEXT,
  is_approved BOOLEAN NOT NULL DEFAULT false,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Comments/Guestbook table
CREATE TABLE IF NOT EXISTS public.comments (
  comment_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES public.users(user_id) ON DELETE CASCADE,
  body TEXT NOT NULL,
  is_approved BOOLEAN NOT NULL DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
```

#### **1.4 Row Level Security Policies**

```sql
-- Enable RLS on all tables
ALTER TABLE public.user_roles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tournament_registrations ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tournament_teams ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.tournament_matches ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.photos ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.comments ENABLE ROW LEVEL SECURITY;

-- Admin policies (admin can do everything)
CREATE POLICY "admin_all_access" ON public.user_roles FOR ALL TO authenticated USING (public.is_admin());
CREATE POLICY "admin_tournament_access" ON public.tournament_registrations FOR ALL TO authenticated USING (public.is_admin());
CREATE POLICY "admin_teams_access" ON public.tournament_teams FOR ALL TO authenticated USING (public.is_admin());
CREATE POLICY "admin_matches_access" ON public.tournament_matches FOR ALL TO authenticated USING (public.is_admin());
CREATE POLICY "admin_photos_access" ON public.photos FOR ALL TO authenticated USING (public.is_admin());
CREATE POLICY "admin_comments_access" ON public.comments FOR ALL TO authenticated USING (public.is_admin());

-- Public read policies for approved content
CREATE POLICY "photos_public_read_approved" ON public.photos FOR SELECT TO anon, authenticated USING (is_approved = true);
CREATE POLICY "comments_public_read_approved" ON public.comments FOR SELECT TO anon, authenticated USING (is_approved = true);
CREATE POLICY "tournament_public_read" ON public.tournament_registrations FOR SELECT TO anon, authenticated USING (true);
CREATE POLICY "teams_public_read" ON public.tournament_teams FOR SELECT TO anon, authenticated USING (true);
CREATE POLICY "matches_public_read" ON public.tournament_matches FOR SELECT TO anon, authenticated USING (true);
```

---

### **Phase 2: Core Admin Components**

#### **2.1 RequireAdmin Component**

```tsx
// src/components/RequireAdmin.tsx
import { useAuth } from '@/lib/auth';
import { supabase } from '@/integrations/supabase/client';
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { useNavigate } from 'react-router-dom';

interface RequireAdminProps {
  children: React.ReactNode;
  fallback?: React.ReactNode;
}

export default function RequireAdmin({ children, fallback }: RequireAdminProps) {
  const { user, loading } = useAuth();
  const [isAdmin, setIsAdmin] = useState(false);
  const [adminLoading, setAdminLoading] = useState(true);
  const navigate = useNavigate();

  useEffect(() => {
    const checkAdminStatus = async () => {
      if (!user) {
        setAdminLoading(false);
        return;
      }

      try {
        const { data, error } = await supabase
          .from('user_roles')
          .select('role')
          .eq('user_id', user.id)
          .single();

        if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned
          console.error('Error checking admin status:', error);
        }

        setIsAdmin(data?.role === 'admin');
      } catch (error) {
        console.error('Error checking admin status:', error);
      } finally {
        setAdminLoading(false);
      }
    };

    checkAdminStatus();
  }, [user]);

  if (loading || adminLoading) {
    return (
      <div className="flex items-center justify-center min-h-[200px]">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
      </div>
    );
  }

  if (!user) {
    return (
      <div className="max-w-md mx-auto my-10 p-6 rounded-2xl shadow-lg bg-black/70 text-white">
        <h2 className="text-xl font-semibold mb-3">Authentication Required</h2>
        <p className="mb-4 text-[--ink]/80">
          Please sign in to access the admin area.
        </p>
        <Button onClick={() => navigate('/auth')} className="w-full">
          Sign In
        </Button>
      </div>
    );
  }

  if (!isAdmin) {
    if (fallback) {
      return <>{fallback}</>;
    }
    
    return (
      <div className="max-w-md mx-auto my-10 p-6 rounded-2xl shadow-lg bg-red-900/70 text-white">
        <h2 className="text-xl font-semibold mb-3">Access Denied</h2>
        <p className="mb-4 text-red-200">
          You don't have admin privileges to access this area.
        </p>
        <Button onClick={() => navigate('/')} variant="outline" className="w-full">
          Return Home
        </Button>
      </div>
    );
  }

  return <>{children}</>;
}
```

#### **2.2 Admin Dashboard**

```tsx
// src/pages/admin/AdminDashboard.tsx
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { supabase } from '@/integrations/supabase/client';
import { useQuery } from '@tanstack/react-query';
import RequireAdmin from '@/components/RequireAdmin';

export default function AdminDashboard() {
  const [activeTab, setActiveTab] = useState('rsvps');

  // RSVPs query
  const { data: rsvps, isLoading: rsvpsLoading } = useQuery({
    queryKey: ['admin-rsvps'],
    queryFn: async () => {
      const { data, error } = await supabase
        .from('rsvps')
        .select(`
          *,
          users!inner(name, email)
        `)
        .order('created_at', { ascending: false });
      
      if (error) throw error;
      return data;
    }
  });

  // Tournament registrations query
  const { data: tournamentRegs, isLoading: tournamentLoading } = useQuery({
    queryKey: ['admin-tournament'],
    queryFn: async () => {
      const { data, error } = await supabase
        .from('tournament_registrations')
        .select(`
          *,
          users!inner(name, email)
        `)
        .order('created_at', { ascending: false });
      
      if (error) throw error;
      return data;
    }
  });

  // Gallery photos query
  const { data: photos, isLoading: photosLoading } = useQuery({
    queryKey: ['admin-photos'],
    queryFn: async () => {
      const { data, error } = await supabase
        .from('photos')
        .select(`
          *,
          users!inner(name, email)
        `)
        .order('created_at', { ascending: false });
      
      if (error) throw error;
      return data;
    }
  });

  const totalGuests = rsvps?.reduce((sum, rsvp) => sum + rsvp.num_guests, 0) || 0;
  const pendingPhotos = photos?.filter(p => !p.is_approved).length || 0;
  const freeAgents = tournamentRegs?.filter(r => r.is_free_agent).length || 0;

  return (
    <RequireAdmin>
      <div className="min-h-screen bg-background p-6">
        <div className="max-w-7xl mx-auto">
          <h1 className="text-3xl font-bold mb-8 text-accent-gold">Admin Control Tower</h1>
          
          {/* Stats Overview */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <Card>
              <CardHeader className="pb-2">
                <CardTitle className="text-sm font-medium">Total RSVPs</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold">{rsvps?.length || 0}</div>
                <p className="text-xs text-muted-foreground">{totalGuests} total guests</p>
              </CardContent>
            </Card>
            
            <Card>
              <CardHeader className="pb-2">
                <CardTitle className="text-sm font-medium">Tournament Entries</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold">{tournamentRegs?.length || 0}</div>
                <p className="text-xs text-muted-foreground">{freeAgents} free agents</p>
              </CardContent>
            </Card>
            
            <Card>
              <CardHeader className="pb-2">
                <CardTitle className="text-sm font-medium">Photos Pending</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="text-2xl font-bold">{pendingPhotos}</div>
                <p className="text-xs text-muted-foreground">Awaiting approval</p>
              </CardContent>
            </Card>
            
            <Card>
              <CardHeader className="pb-2">
                <CardTitle className="text-sm font-medium">System Status</CardTitle>
              </CardHeader>
              <CardContent>
                <Badge variant="outline" className="text-green-600">Online</Badge>
              </CardContent>
            </Card>
          </div>

          {/* Navigation Tabs */}
          <div className="flex space-x-1 mb-6">
            {[
              { id: 'rsvps', label: 'RSVPs', count: rsvps?.length },
              { id: 'tournament', label: 'Tournament', count: tournamentRegs?.length },
              { id: 'gallery', label: 'Gallery', count: photos?.length },
              { id: 'users', label: 'Users', count: rsvps?.length }
            ].map((tab) => (
              <Button
                key={tab.id}
                variant={activeTab === tab.id ? 'default' : 'outline'}
                onClick={() => setActiveTab(tab.id)}
                className="relative"
              >
                {tab.label}
                {tab.count !== undefined && (
                  <Badge variant="secondary" className="ml-2">
                    {tab.count}
                  </Badge>
                )}
              </Button>
            ))}
          </div>

          {/* Tab Content */}
          <div className="bg-card rounded-lg border">
            {activeTab === 'rsvps' && <RSVPsTab rsvps={rsvps} loading={rsvpsLoading} />}
            {activeTab === 'tournament' && <TournamentTab registrations={tournamentRegs} loading={tournamentLoading} />}
            {activeTab === 'gallery' && <GalleryTab photos={photos} loading={photosLoading} />}
            {activeTab === 'users' && <UsersTab />}
          </div>
        </div>
      </div>
    </RequireAdmin>
  );
}
```

#### **2.3 Shared Admin Components**

```tsx
// src/components/admin/AdminTable.tsx
import { useState } from 'react';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { Search, Download, Edit, Trash2 } from 'lucide-react';

interface AdminTableProps {
  data: any[];
  columns: Array<{
    key: string;
    label: string;
    render?: (value: any, row: any) => React.ReactNode;
  }>;
  onEdit?: (row: any) => void;
  onDelete?: (row: any) => void;
  onExport?: () => void;
  searchable?: boolean;
  loading?: boolean;
}

export function AdminTable({ 
  data, 
  columns, 
  onEdit, 
  onDelete, 
  onExport, 
  searchable = true,
  loading = false 
}: AdminTableProps) {
  const [searchTerm, setSearchTerm] = useState('');
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 10;

  const filteredData = data?.filter(row =>
    searchable ? 
      Object.values(row).some(value => 
        String(value).toLowerCase().includes(searchTerm.toLowerCase())
      ) : true
  ) || [];

  const paginatedData = filteredData.slice(
    (currentPage - 1) * itemsPerPage,
    currentPage * itemsPerPage
  );

  if (loading) {
    return (
      <div className="flex items-center justify-center p-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-accent"></div>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {/* Toolbar */}
      <div className="flex justify-between items-center">
        <div className="flex items-center space-x-4">
          {searchable && (
            <div className="relative">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4" />
              <Input
                placeholder="Search..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="pl-10 w-64"
              />
            </div>
          )}
        </div>
        
        <div className="flex items-center space-x-2">
          {onExport && (
            <Button variant="outline" onClick={onExport}>
              <Download className="h-4 w-4 mr-2" />
              Export CSV
            </Button>
          )}
        </div>
      </div>

      {/* Table */}
      <div className="border rounded-lg">
        <Table>
          <TableHeader>
            <TableRow>
              {columns.map((column) => (
                <TableHead key={column.key}>{column.label}</TableHead>
              ))}
              {(onEdit || onDelete) && <TableHead>Actions</TableHead>}
            </TableRow>
          </TableHeader>
          <TableBody>
            {paginatedData.map((row, index) => (
              <TableRow key={index}>
                {columns.map((column) => (
                  <TableCell key={column.key}>
                    {column.render ? column.render(row[column.key], row) : row[column.key]}
                  </TableCell>
                ))}
                {(onEdit || onDelete) && (
                  <TableCell>
                    <div className="flex space-x-2">
                      {onEdit && (
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => onEdit(row)}
                        >
                          <Edit className="h-4 w-4" />
                        </Button>
                      )}
                      {onDelete && (
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => onDelete(row)}
                        >
                          <Trash2 className="h-4 w-4" />
                        </Button>
                      )}
                    </div>
                  </TableCell>
                )}
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </div>

      {/* Pagination */}
      {filteredData.length > itemsPerPage && (
        <div className="flex justify-center space-x-2">
          <Button
            variant="outline"
            onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
            disabled={currentPage === 1}
          >
            Previous
          </Button>
          <span className="flex items-center px-4">
            Page {currentPage} of {Math.ceil(filteredData.length / itemsPerPage)}
          </span>
          <Button
            variant="outline"
            onClick={() => setCurrentPage(prev => Math.min(Math.ceil(filteredData.length / itemsPerPage), prev + 1))}
            disabled={currentPage === Math.ceil(filteredData.length / itemsPerPage)}
          >
            Next
          </Button>
        </div>
      )}
    </div>
  );
}
```

---

### **Phase 3: High Priority Features (MVP)**

#### **3.1 RSVP Management**

**Features:**
- View all RSVPs with user details
- Search and filter by name, email, status
- Inline editing of guest count, dietary restrictions, contributions
- Status management (pending, confirmed, cancelled)
- CSV export functionality
- Bulk operations

**Implementation:**
```tsx
// src/pages/admin/RSVPsTab.tsx
import { useState } from 'react';
import { AdminTable } from '@/components/admin/AdminTable';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';

export function RSVPsTab({ rsvps, loading }: { rsvps: any[], loading: boolean }) {
  const { toast } = useToast();
  const [editingRow, setEditingRow] = useState(null);

  const columns = [
    { key: 'users.name', label: 'Name' },
    { key: 'users.email', label: 'Email' },
    { 
      key: 'num_guests', 
      label: 'Guests',
      render: (value: number, row: any) => (
        <span className="font-mono">{value}</span>
      )
    },
    { 
      key: 'status', 
      label: 'Status',
      render: (value: string) => (
        <Badge variant={value === 'confirmed' ? 'default' : 'secondary'}>
          {value}
        </Badge>
      )
    },
    { key: 'dietary_restrictions', label: 'Dietary' },
    { key: 'contributions', label: 'Contributions' },
    { key: 'created_at', label: 'RSVP Date' }
  ];

  const handleEdit = (row: any) => {
    setEditingRow(row);
  };

  const handleSave = async (updatedRow: any) => {
    try {
      const { error } = await supabase
        .from('rsvps')
        .update({
          num_guests: updatedRow.num_guests,
          status: updatedRow.status,
          dietary_restrictions: updatedRow.dietary_restrictions,
          contributions: updatedRow.contributions
        })
        .eq('rsvp_id', updatedRow.rsvp_id);

      if (error) throw error;

      toast({
        title: "RSVP Updated",
        description: "The RSVP has been successfully updated.",
      });
      setEditingRow(null);
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to update RSVP. Please try again.",
        variant: "destructive"
      });
    }
  };

  const handleExport = () => {
    const csvContent = [
      ['Name', 'Email', 'Guests', 'Status', 'Dietary', 'Contributions', 'Date'],
      ...rsvps.map(rsvp => [
        rsvp.users.name,
        rsvp.users.email,
        rsvp.num_guests,
        rsvp.status,
        rsvp.dietary_restrictions || '',
        rsvp.contributions || '',
        new Date(rsvp.created_at).toLocaleDateString()
      ])
    ].map(row => row.join(',')).join('\n');

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `rsvps-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  };

  return (
    <div className="p-6">
      <AdminTable
        data={rsvps || []}
        columns={columns}
        onEdit={handleEdit}
        onExport={handleExport}
        loading={loading}
      />
    </div>
  );
}
```

#### **3.2 Tournament Management**

**Features:**
- View all tournament registrations
- Manage team formation
- Free agent matching
- Bracket generation
- Match result entry
- Tournament statistics

**Implementation:**
```tsx
// src/pages/admin/TournamentTab.tsx
import { useState } from 'react';
import { AdminTable } from '@/components/admin/AdminTable';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export function TournamentTab({ registrations, loading }: { registrations: any[], loading: boolean }) {
  const [activeView, setActiveView] = useState('registrations');

  const registrationColumns = [
    { key: 'users.name', label: 'Player' },
    { key: 'users.email', label: 'Email' },
    { key: 'team_name', label: 'Team Name' },
    { key: 'partner_email', label: 'Partner' },
    { 
      key: 'skill_level', 
      label: 'Skill',
      render: (value: string) => (
        <Badge variant="outline">{value}</Badge>
      )
    },
    { key: 'tagline', label: 'Tagline' },
    { 
      key: 'is_free_agent', 
      label: 'Status',
      render: (value: boolean) => (
        <Badge variant={value ? 'destructive' : 'default'}>
          {value ? 'Free Agent' : 'Paired'}
        </Badge>
      )
    }
  ];

  const freeAgents = registrations?.filter(r => r.is_free_agent) || [];
  const pairedPlayers = registrations?.filter(r => !r.is_free_agent) || [];

  return (
    <div className="p-6 space-y-6">
      {/* Tournament Stats */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm">Total Entries</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{registrations?.length || 0}</div>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm">Free Agents</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-red-600">{freeAgents.length}</div>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm">Paired Players</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold text-green-600">{pairedPlayers.length}</div>
          </CardContent>
        </Card>
      </div>

      {/* View Toggle */}
      <div className="flex space-x-2">
        <Button
          variant={activeView === 'registrations' ? 'default' : 'outline'}
          onClick={() => setActiveView('registrations')}
        >
          All Registrations
        </Button>
        <Button
          variant={activeView === 'free-agents' ? 'default' : 'outline'}
          onClick={() => setActiveView('free-agents')}
        >
          Free Agents ({freeAgents.length})
        </Button>
        <Button
          variant={activeView === 'brackets' ? 'default' : 'outline'}
          onClick={() => setActiveView('brackets')}
        >
          Tournament Brackets
        </Button>
      </div>

      {/* Content */}
      {activeView === 'registrations' && (
        <AdminTable
          data={registrations || []}
          columns={registrationColumns}
          loading={loading}
        />
      )}
      
      {activeView === 'free-agents' && (
        <AdminTable
          data={freeAgents}
          columns={registrationColumns}
          loading={loading}
        />
      )}
      
      {activeView === 'brackets' && (
        <div className="text-center py-8 text-muted-foreground">
          Tournament bracket management coming soon...
        </div>
      )}
    </div>
  );
}
```

#### **3.3 Gallery Management**

**Features:**
- Photo approval/rejection system
- Bulk photo operations
- Photo metadata editing
- Storage cleanup tools

**Implementation:**
```tsx
// src/pages/admin/GalleryTab.tsx
import { useState } from 'react';
import { AdminTable } from '@/components/admin/AdminTable';
import { Badge } from '@/components/ui/badge';
import { Button } from '@/components/ui/button';
import { Check, X, Eye } from 'lucide-react';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';

export function GalleryTab({ photos, loading }: { photos: any[], loading: boolean }) {
  const { toast } = useToast();
  const [selectedPhotos, setSelectedPhotos] = useState<string[]>([]);

  const columns = [
    { 
      key: 'photo_id', 
      label: 'Preview',
      render: (value: string, row: any) => (
        <div className="w-16 h-16 bg-muted rounded overflow-hidden">
          <img 
            src={`${supabase.storage.from('gallery').getPublicUrl(row.storage_path).data.publicUrl}`}
            alt=""
            className="w-full h-full object-cover"
          />
        </div>
      )
    },
    { key: 'users.name', label: 'Uploader' },
    { key: 'users.email', label: 'Email' },
    { key: 'caption', label: 'Caption' },
    { 
      key: 'is_approved', 
      label: 'Status',
      render: (value: boolean) => (
        <Badge variant={value ? 'default' : 'destructive'}>
          {value ? 'Approved' : 'Pending'}
        </Badge>
      )
    },
    { key: 'created_at', label: 'Upload Date' }
  ];

  const handleApprove = async (photoId: string) => {
    try {
      const { error } = await supabase
        .from('photos')
        .update({ is_approved: true })
        .eq('photo_id', photoId);

      if (error) throw error;

      toast({
        title: "Photo Approved",
        description: "The photo has been approved and is now visible to guests.",
      });
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to approve photo. Please try again.",
        variant: "destructive"
      });
    }
  };

  const handleReject = async (photoId: string) => {
    try {
      const { error } = await supabase
        .from('photos')
        .delete()
        .eq('photo_id', photoId);

      if (error) throw error;

      toast({
        title: "Photo Rejected",
        description: "The photo has been removed from the gallery.",
      });
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to reject photo. Please try again.",
        variant: "destructive"
      });
    }
  };

  const handleBulkApprove = async () => {
    try {
      const { error } = await supabase
        .from('photos')
        .update({ is_approved: true })
        .in('photo_id', selectedPhotos);

      if (error) throw error;

      toast({
        title: "Photos Approved",
        description: `${selectedPhotos.length} photos have been approved.`,
      });
      setSelectedPhotos([]);
    } catch (error) {
      toast({
        title: "Error",
        description: "Failed to approve photos. Please try again.",
        variant: "destructive"
      });
    }
  };

  return (
    <div className="p-6 space-y-4">
      {/* Bulk Actions */}
      {selectedPhotos.length > 0 && (
        <div className="flex items-center space-x-2 p-4 bg-muted rounded-lg">
          <span className="text-sm">{selectedPhotos.length} photos selected</span>
          <Button size="sm" onClick={handleBulkApprove}>
            <Check className="h-4 w-4 mr-2" />
            Approve Selected
          </Button>
        </div>
      )}

      <AdminTable
        data={photos || []}
        columns={columns}
        onEdit={(row) => handleApprove(row.photo_id)}
        loading={loading}
      />
    </div>
  );
}
```

---

### **Phase 4: Medium Priority Features**

#### **4.1 User Management**

**Features:**
- User role assignment
- User profile management
- Communication tools (email users)
- User activity monitoring

#### **4.2 Comment Moderation**

**Features:**
- Comment approval system
- Spam detection and filtering
- Comment editing and deletion
- User communication tools

#### **4.3 Basic Analytics Dashboard**

**Features:**
- RSVP trends and statistics
- Popular costume ideas
- Dietary restriction summaries
- Contribution tracking
- Photo upload analytics

---

### **Phase 5: Low Priority Features (Nice-to-Have)**

#### **5.1 Advanced Analytics**

**Features:**
- Real-time event metrics
- User engagement tracking
- Performance analytics
- Custom reporting tools
- Data visualization charts

**Implementation:**
```tsx
// src/pages/admin/AnalyticsTab.tsx
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';

export function AnalyticsTab() {
  // Analytics data and charts
  return (
    <div className="p-6 space-y-6">
      <h2 className="text-2xl font-bold">Event Analytics</h2>
      
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>RSVP Trends</CardTitle>
          </CardHeader>
          <CardContent>
            <ResponsiveContainer width="100%" height={300}>
              <LineChart data={rsvpTrends}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="date" />
                <YAxis />
                <Tooltip />
                <Line type="monotone" dataKey="count" stroke="#8884d8" />
              </LineChart>
            </ResponsiveContainer>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader>
            <CardTitle>Costume Ideas</CardTitle>
          </CardHeader>
          <CardContent>
            {/* Costume popularity chart */}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}
```

#### **5.2 Communication Tools**

**Features:**
- Bulk email to guests
- Event announcements
- RSVP reminders
- Custom notifications
- Email templates
- Scheduled messaging

**Implementation:**
```tsx
// src/pages/admin/CommunicationTab.tsx
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';

export function CommunicationTab() {
  const [emailData, setEmailData] = useState({
    subject: '',
    message: '',
    recipients: 'all' // all, rsvp, tournament, custom
  });

  const handleSendEmail = async () => {
    // Send bulk email logic
  };

  return (
    <div className="p-6 space-y-6">
      <h2 className="text-2xl font-bold">Communication Center</h2>
      
      <Card>
        <CardHeader>
          <CardTitle>Send Email to Guests</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <Label htmlFor="recipients">Recipients</Label>
            <select 
              id="recipients"
              value={emailData.recipients}
              onChange={(e) => setEmailData(prev => ({ ...prev, recipients: e.target.value }))}
              className="w-full p-2 border rounded"
            >
              <option value="all">All Guests</option>
              <option value="rsvp">RSVP Guests Only</option>
              <option value="tournament">Tournament Players Only</option>
              <option value="custom">Custom List</option>
            </select>
          </div>
          
          <div>
            <Label htmlFor="subject">Subject</Label>
            <Input
              id="subject"
              value={emailData.subject}
              onChange={(e) => setEmailData(prev => ({ ...prev, subject: e.target.value }))}
              placeholder="Email subject..."
            />
          </div>
          
          <div>
            <Label htmlFor="message">Message</Label>
            <Textarea
              id="message"
              value={emailData.message}
              onChange={(e) => setEmailData(prev => ({ ...prev, message: e.target.value }))}
              placeholder="Your message..."
              rows={6}
            />
          </div>
          
          <Button onClick={handleSendEmail} className="w-full">
            Send Email
          </Button>
        </CardContent>
      </Card>
    </div>
  );
}
```

#### **5.3 Scavenger Hunt Management**

**Features:**
- Hint management (add/edit/remove hints)
- Progress monitoring per user
- Reward system management
- Hunt analytics
- Hint placement tools

**Implementation:**
```tsx
// src/pages/admin/HuntTab.tsx
import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';

export function HuntTab() {
  const [hints, setHints] = useState([]);
  const [newHint, setNewHint] = useState({ text: '', location: '' });

  const handleAddHint = async () => {
    // Add new hint logic
  };

  const handleEditHint = async (hintId: string, updates: any) => {
    // Edit hint logic
  };

  const handleDeleteHint = async (hintId: string) => {
    // Delete hint logic
  };

  return (
    <div className="p-6 space-y-6">
      <h2 className="text-2xl font-bold">Scavenger Hunt Management</h2>
      
      {/* Add New Hint */}
      <Card>
        <CardHeader>
          <CardTitle>Add New Hint</CardTitle>
        </CardHeader>
        <CardContent className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-2">Hint Text</label>
            <Textarea
              value={newHint.text}
              onChange={(e) => setNewHint(prev => ({ ...prev, text: e.target.value }))}
              placeholder="Enter the hint text..."
              rows={3}
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-2">Location</label>
            <Input
              value={newHint.location}
              onChange={(e) => setNewHint(prev => ({ ...prev, location: e.target.value }))}
              placeholder="e.g., Hero, Costumes, Footer"
            />
          </div>
          
          <Button onClick={handleAddHint}>
            Add Hint
          </Button>
        </CardContent>
      </Card>

      {/* Existing Hints */}
      <Card>
        <CardHeader>
          <CardTitle>Current Hints</CardTitle>
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            {hints.map((hint) => (
              <div key={hint.id} className="flex items-center justify-between p-4 border rounded">
                <div>
                  <p className="font-medium">{hint.text}</p>
                  <Badge variant="outline">{hint.location}</Badge>
                </div>
                <div className="flex space-x-2">
                  <Button size="sm" variant="outline">
                    Edit
                  </Button>
                  <Button size="sm" variant="destructive">
                    Delete
                  </Button>
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

#### **5.4 System Administration**

**Features:**
- Database maintenance
- Backup management
- Performance monitoring
- Error logging
- Security monitoring
- System health checks

**Implementation:**
```tsx
// src/pages/admin/SystemTab.tsx
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Activity, Database, Shield, AlertTriangle } from 'lucide-react';

export function SystemTab() {
  const [systemStatus, setSystemStatus] = useState({
    database: 'healthy',
    storage: 'healthy',
    auth: 'healthy',
    performance: 'good'
  });

  const handleBackup = async () => {
    // Database backup logic
  };

  const handleMaintenance = async () => {
    // System maintenance logic
  };

  return (
    <div className="p-6 space-y-6">
      <h2 className="text-2xl font-bold">System Administration</h2>
      
      {/* System Status */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center">
              <Database className="h-4 w-4 mr-2" />
              Database
            </CardTitle>
          </CardHeader>
          <CardContent>
            <Badge variant={systemStatus.database === 'healthy' ? 'default' : 'destructive'}>
              {systemStatus.database}
            </Badge>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center">
              <Activity className="h-4 w-4 mr-2" />
              Performance
            </CardTitle>
          </CardHeader>
          <CardContent>
            <Badge variant={systemStatus.performance === 'good' ? 'default' : 'destructive'}>
              {systemStatus.performance}
            </Badge>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center">
              <Shield className="h-4 w-4 mr-2" />
              Security
            </CardTitle>
          </CardHeader>
          <CardContent>
            <Badge variant="default">Secure</Badge>
          </CardContent>
        </Card>
        
        <Card>
          <CardHeader className="pb-2">
            <CardTitle className="text-sm flex items-center">
              <AlertTriangle className="h-4 w-4 mr-2" />
              Alerts
            </CardTitle>
          </CardHeader>
          <CardContent>
            <Badge variant="outline">0</Badge>
          </CardContent>
        </Card>
      </div>

      {/* System Actions */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Card>
          <CardHeader>
            <CardTitle>Database Operations</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <Button onClick={handleBackup} className="w-full">
              Create Backup
            </Button>
            <Button variant="outline" className="w-full">
              View Logs
            </Button>
          </CardContent>
        </Card>
        
        <Card>