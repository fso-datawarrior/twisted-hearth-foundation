@tailwind base;
@tailwind components;
@tailwind utilities;

/* Twisted Fairytale Halloween Design System
All colors are HSL for consistency. Motion respects prefers-reduced-motion.
Modern CSS Architecture with Cascade Layers for better specificity management.
*/

/* CSS Cascade Layers - Modern specificity management */
@layer reset, base, components, utilities, overrides;

@layer base {
  :root {
    /* Core Gothic Theme Colors */
    --bg: 219 8% 4%; /* #0B0B0C - Deep charcoal */
    --bg-2: 226 35% 17%; /* #1A1F3A - Midnight purple */
    --ink: 0 0% 93%; /* #EDEDED - Soft white */
    
    /* Fairytale Accent Palette */
    --accent-purple: 285 46% 21%; /* #3B1F4A - Enchanted purple */
    --accent-green: 142 25% 33%; /* #3B6E47 - Forest green */
    --accent-red: 0 100% 27%; /* #8B0000 - Blood red */
    --accent-gold: 44 35% 57%; /* #C5A45D - Ancient gold */
    
    /* Semantic Mappings */
    --background: var(--bg);
    --foreground: var(--ink);
    --card: var(--bg-2);
    --card-foreground: var(--ink);
    --popover: var(--bg-2);
    --popover-foreground: var(--ink);
    --primary: var(--accent-purple);
    --primary-foreground: var(--ink);
    --secondary: var(--bg-2);
    --secondary-foreground: var(--ink);
    --muted: var(--bg-2);
    --muted-foreground: 0 0% 65%;
    --accent: var(--accent-gold);
    --accent-foreground: var(--bg);
    --destructive: var(--accent-red);
    --destructive-foreground: var(--ink);
    --border: 226 35% 25%;
    --input: var(--bg-2);
    --ring: var(--accent-purple);
    --radius: 0.75rem;
    
  /* Component-specific */
  --navbar-bg: rgba(59, 31, 74, 0.95); /* Translucent purple */
  --hero-overlay: rgba(11, 11, 12, 0.6);
  --glow-purple: rgba(197, 164, 93, 0.3);
  --glow-gold: rgba(197, 164, 93, 0.5);
  
  /* Modern CSS Features */
  --hunt-glow: hsl(120 50% 50% / 0.3);
  --hunt-glow-hover: hsl(120 50% 50% / 0.6);
  --theme-bg: light-dark(#f8f9fa, #0B0B0C);
  --theme-text: light-dark(#212529, #EDEDED);
  
  /* Container Query Support */
  --container-inline-size: 100%;
  --container-block-size: auto;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  
  body {
    @apply bg-background text-foreground font-body;
    /* Smooth scrolling for better UX */
  scroll-behavior: smooth;
  
  /* Text shadows for hero overlay */
  --text-shadow-gothic: 2px 2px 4px hsl(var(--bg) / 0.8), 
                        0 0 8px hsl(var(--accent-purple) / 0.6);
  }
  
  /* Typography scale */
  .font-heading {
    font-family: 'Cinzel Decorative', serif;
  }
  
  .font-subhead {
    font-family: 'IM Fell English SC', serif;
  }
  
  .font-body {
    font-family: 'Inter', sans-serif;
  }
  
  /* Focus visible for accessibility */
  .focus-visible {
    @apply outline-none ring-2 ring-accent ring-offset-2 ring-offset-background;
  }
  
  /* Global consistent focus ring */
  :where(button, [href], input, select, textarea, [tabindex]):focus-visible {
    outline: 2px solid hsl(var(--accent-gold));
    outline-offset: 2px;
  }
  
  /* Motion system - respects user preferences */
  .motion-safe {
    transition: all 0.2s ease-out;
  }
  
  @media (prefers-reduced-motion: reduce) {
    .motion-safe {
      transition: none;
    }
    
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
}

@layer components {
  /* Hunt rune found state enhancement */
  .hunt-rune[aria-pressed="true"] { 
    filter: saturate(1.1) brightness(1.1); 
  }
  
  /* Section reveal styles */
  .reveal {
    opacity: 0;
    transform: translateY(10px);
  }

  .reveal--shown {
    opacity: 1;
    transform: translateY(0);
    animation: rise-fade 450ms ease-out both;
  }

  @media (prefers-reduced-motion: reduce) {
    .reveal, .reveal--shown { 
      animation: none !important; 
      transform: none !important; 
      opacity: 1 !important; 
    }
  }
  
  /* Glow effects for interactive elements */
  .glow-purple {
    box-shadow: 0 0 20px var(--glow-purple);
  }
  
  .glow-gold {
    box-shadow: 0 0 20px var(--glow-gold);
  }
  
  /* Gothic text shadow for headings */
  .text-shadow-gothic {
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  }
  
  /* Hover tilt effect */
  .hover-tilt {
    transition: transform 0.2s ease-out;
  }
  
  .hover-tilt:hover {
    transform: rotate(-2deg) scale(1.02);
  }
  
  @media (prefers-reduced-motion: reduce) {
    .hover-tilt:hover {
      transform: none;
    }
  }
  
  /* Micro-interactions with motion safety */
  .motion-safe\:hover\:scale-\[1\.01\]:hover {
    transform: scale(1.01);
  }
  
  .motion-safe\:active\:scale-\[0\.99\]:active {
    transform: scale(0.99);
  }
  
  .motion-safe\:hover\:-translate-y-0\.5:hover {
    transform: translateY(-0.125rem);
  }
  
  /* Fade in animations */
  .animate-fade-in {
    animation: fade-in 0.6s ease-out;
  }
  
  .animate-scale-in {
    animation: scale-in 0.3s ease-out;
  }
  
  .animation-delay-300 {
    animation-delay: 0.3s;
  }
  
  .animation-delay-600 {
    animation-delay: 0.6s;
  }
  
  /* Interactive Elements */
  .story-link {
    @apply relative inline-block after:content-[''] after:absolute after:w-full after:scale-x-0 after:h-0.5 after:bottom-0 after:left-0 after:bg-accent-gold after:origin-bottom-right after:transition-transform after:duration-300 hover:after:scale-x-100 hover:after:origin-bottom-left;
  }

  .hover-scale {
    @apply transition-transform duration-200 hover:scale-105;
  }

  .hover-tilt {
    @apply transition-transform duration-300 hover:rotate-1;
  }

  .glow-gold {
    @apply shadow-[0_0_20px_hsl(var(--accent-gold)/0.3)] hover:shadow-[0_0_30px_hsl(var(--accent-gold)/0.5)];
  }

  .text-shadow-gothic {
    text-shadow: var(--text-shadow-gothic);
  }
}

/* Modern CSS Features Layer */
@layer components {
  /* CSS Container Queries for Responsive Components */
  .vignette-card {
    container-type: inline-size;
    container-name: vignette;
  }

  @container vignette (min-width: 300px) {
    .vignette-card__content {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 1rem;
    }
  }

  @container vignette (min-width: 400px) {
    .vignette-card__content {
      grid-template-columns: 1fr 3fr;
    }
  }

  /* Hunt Hint Container Queries */
  .hunt-hint {
    container-type: inline-size;
    container-name: hunt-hint;
  }

  @container hunt-hint (min-width: 200px) {
    .hunt-hint__content {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
  }

  /* Modern CSS Grid with Subgrid */
  .vignette-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: clamp(1rem, 2vw, 2rem);
  }

  .vignette-card {
    display: grid;
    grid-template-rows: subgrid;
    grid-row: span 3;
  }

  /* CSS View Transitions API */
  ::view-transition-old(root) {
    animation: slide-out 0.3s ease-in-out;
  }

  ::view-transition-new(root) {
    animation: slide-in 0.3s ease-in-out;
  }

  /* CSS Scroll-Driven Animations for Hunt Hints */
  @keyframes reveal-hint {
    from { 
      opacity: 0; 
      transform: translateY(20px) scale(0.95); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0) scale(1); 
    }
  }

  .hunt-hint {
    animation: reveal-hint linear both;
    animation-timeline: scroll();
    animation-range: entry 0% entry 100%;
  }

  /* CSS Houdini Paint API for Progress Ring */
  .hunt-progress-ring {
    background-image: paint(hunt-progress);
    --progress: 0.6;
    --color: #3B6E47;
    --size: 60px;
    --thickness: 4px;
  }

  /* CSS :has() Selector for Dynamic Styling */
  .vignette-card:has(.hunt-hint.found) {
    border-color: var(--accent-green);
    box-shadow: 0 0 20px var(--hunt-glow);
  }

  .hunt-section:has(.hunt-hint.found) {
    background: linear-gradient(135deg, 
      hsl(var(--bg-2) / 0.8), 
      hsl(var(--accent-purple) / 0.1)
    );
  }

  /* Modern Backdrop Filter Effects */
  .hunt-modal {
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    backdrop-filter: blur(10px) saturate(180%);
    background: rgba(11, 11, 12, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .glassmorphism-card {
    -webkit-backdrop-filter: blur(8px) saturate(150%);
    backdrop-filter: blur(8px) saturate(150%);
    background: rgba(26, 31, 58, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* CSS Clip-path for Creative Shapes */
  .vignette-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100px;
    height: 100px;
    background: var(--accent-red);
    clip-path: polygon(0 0, 100% 0, 100% 100%);
    opacity: 0.1;
  }

  /* Enhanced Focus Management */
  .hunt-hint:focus-visible {
    outline: 2px solid var(--accent-green);
    outline-offset: 2px;
    box-shadow: 0 0 0 4px var(--hunt-glow);
  }

  /* Modern CSS Custom Properties with Fallbacks */
  .hunt-hint:hover {
    box-shadow: 0 0 20px var(--hunt-glow-hover);
    transform: scale(1.02);
  }

  /* CSS Containment for Performance */
  .vignette-section {
    contain: layout style paint;
  }

  .hunt-hint {
    contain: layout style;
  }

  /* Progressive Enhancement */
  .hunt-hint {
    opacity: 0.7;
    transition: opacity 0.3s ease, transform 0.2s ease;
  }

  .hunt-hint--interactive {
    opacity: 1;
    cursor: pointer;
  }

  .hunt-hint--interactive:hover {
    opacity: 1;
    transform: scale(1.05);
  }
}

@keyframes rise-fade {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes fade-in {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes slide-out {
  from {
    opacity: 1;
    transform: translateX(0);
  }
  to {
    opacity: 0;
    transform: translateX(-100%);
  }
}

@keyframes slide-in {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Stagewise Component Inspection Styles */
.stagewise-inspect-mode * {
  position: relative;
}

.stagewise-inspect-mode *:hover {
  outline: 2px solid #3B82F6 !important;
  outline-offset: 2px !important;
  background-color: rgba(59, 130, 246, 0.1) !important;
  cursor: pointer !important;
}

.stagewise-inspect-mode [data-stagewise-component] {
  outline: 2px solid #10B981 !important;
  outline-offset: 2px !important;
  background-color: rgba(16, 185, 129, 0.1) !important;
}

.stagewise-inspect-mode [data-stagewise-component]:hover {
  outline: 2px solid #F59E0B !important;
  outline-offset: 2px !important;
  background-color: rgba(245, 158, 11, 0.2) !important;
}

/* Prevent screenshot functionality on Stagewise buttons */
[data-stagewise-component-info] button {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

[data-stagewise-component-info] button:active {
  transform: scale(0.98);
}

/* Prevent context menu on Stagewise buttons */
[data-stagewise-component-info] button {
  -webkit-context-menu: none;
  -moz-context-menu: none;
  -ms-context-menu: none;
  context-menu: none;
}

/* Isolate Stagewise overlay from component selection */
[data-stagewise-component-info] {
  pointer-events: auto;
  z-index: 10000;
}

[data-stagewise-component-info] * {
  pointer-events: auto;
}

/* Prevent component selection on Stagewise overlay */
[data-stagewise-component-info] {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Stagewise Debug Panel Styles */
[data-stagewise-debug] {
  font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
  font-size: 11px;
  line-height: 1.4;
}

[data-stagewise-performance] {
  font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
  font-size: 11px;
  line-height: 1.4;
}

/* Stagewise Toolbar Animation */
[data-stagewise-toolbar] {
  animation: slideInFromRight 0.3s ease-out;
}

@keyframes slideInFromRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* --- Secret Nav: scroll-driven hint --- */
@supports (animation-timeline: scroll()) {
  @scroll-timeline pageScroll {
    source: auto;
    orientation: block;
  }
  .nav-glow {
    animation: mirrorGlow 1.2s linear both;
    animation-timeline: pageScroll;
  }
  @keyframes mirrorGlow {
    0%   { filter: drop-shadow(0 0 0 rgba(255, 200, 255, 0)); }
    100% { filter: drop-shadow(0 0 12px rgba(255, 200, 255, 0.35)); }
  }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .nav-glow { animation: none !important; }
}

/* Modern CSS Utilities Layer */
@layer utilities {
  /* Screen Reader Only */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Focus Visible Only */
  .focus-visible-only:focus:not(:focus-visible) {
    outline: none;
  }

  /* Container Query Utilities */
  .container-inline {
    container-type: inline-size;
  }

  .container-block {
    container-type: block-size;
  }

  .container-both {
    container-type: inline-size block-size;
  }

  /* Modern Grid Utilities */
  .grid-auto-fit {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }

  .grid-auto-fill {
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  }

  /* Clamp Utilities */
  .text-responsive {
    font-size: clamp(1rem, 2.5vw, 2rem);
  }

  .spacing-responsive {
    gap: clamp(1rem, 2vw, 2rem);
  }

  /* Backdrop Filter Utilities */
  .backdrop-blur-sm {
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
  }

  .backdrop-blur-md {
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
  }

  .backdrop-blur-lg {
    -webkit-backdrop-filter: blur(12px);
    backdrop-filter: blur(12px);
  }

  /* Modern Focus States */
  .focus-ring {
    outline: 2px solid transparent;
    outline-offset: 2px;
  }

  .focus-ring:focus-visible {
    outline: 2px solid hsl(var(--accent-gold));
    outline-offset: 2px;
  }

  /* Hunt Progress Utilities */
  .hunt-progress-0 { --progress: 0; }
  .hunt-progress-25 { --progress: 0.25; }
  .hunt-progress-50 { --progress: 0.5; }
  .hunt-progress-75 { --progress: 0.75; }
  .hunt-progress-100 { --progress: 1; }

  /* Animation Utilities */
  .animate-reveal {
    animation: reveal-hint linear both;
    animation-timeline: scroll();
    animation-range: entry 0% entry 100%;
  }

  .animate-fade-in-up {
    animation: fade-in-up 0.6s ease-out;
  }

  .animate-scale-in {
    animation: scale-in 0.3s ease-out;
  }

  /* Modern Layout Utilities */
  .aspect-video {
    aspect-ratio: 16 / 9;
  }

  .aspect-square {
    aspect-ratio: 1 / 1;
  }

  .aspect-portrait {
    aspect-ratio: 3 / 4;
  }

  /* CSS Logical Properties */
  .inset-inline-start-0 {
    inset-inline-start: 0;
  }

  .inset-inline-end-0 {
    inset-inline-end: 0;
  }

  .margin-inline-auto {
    margin-inline: auto;
  }

  .padding-inline-4 {
    padding-inline: 1rem;
  }

  .padding-block-4 {
    padding-block: 1rem;
  }
}

@keyframes fade-in-up {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Stagewise Component Inspection Styles */
.stagewise-inspect-mode * {
  position: relative;
}

.stagewise-inspect-mode *:hover {
  outline: 2px solid #3B82F6 !important;
  outline-offset: 2px !important;
  background-color: rgba(59, 130, 246, 0.1) !important;
  cursor: pointer !important;
}

.stagewise-inspect-mode [data-stagewise-component] {
  outline: 2px solid #10B981 !important;
  outline-offset: 2px !important;
  background-color: rgba(16, 185, 129, 0.1) !important;
}

.stagewise-inspect-mode [data-stagewise-component]:hover {
  outline: 2px solid #F59E0B !important;
  outline-offset: 2px !important;
  background-color: rgba(245, 158, 11, 0.2) !important;
}

/* Prevent screenshot functionality on Stagewise buttons */
[data-stagewise-component-info] button {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

[data-stagewise-component-info] button:active {
  transform: scale(0.98);
}

/* Prevent context menu on Stagewise buttons */
[data-stagewise-component-info] button {
  -webkit-context-menu: none;
  -moz-context-menu: none;
  -ms-context-menu: none;
  context-menu: none;
}

/* Isolate Stagewise overlay from component selection */
[data-stagewise-component-info] {
  pointer-events: auto;
  z-index: 10000;
}

[data-stagewise-component-info] * {
  pointer-events: auto;
}

/* Prevent component selection on Stagewise overlay */
[data-stagewise-component-info] {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Stagewise Debug Panel Styles */
[data-stagewise-debug] {
  font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
  font-size: 11px;
  line-height: 1.4;
}
